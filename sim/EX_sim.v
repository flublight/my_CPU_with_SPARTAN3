`timescale 1ns / 1ps
//////////////////////////////////////////////////////////////////////////////////
// Company:
// Engineer:
//
// Create Date: 2018/03/19 16:10:43
// Design Name:
// Module Name: IF_sim
// Project Name:
// Target Devices:
// Tool Versions:
// Description:
//
// Dependencies:
//
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
//
//////////////////////////////////////////////////////////////////////////////////
`define WORD 32  // 1word
`define WORD_ADDR_W 30  // address width 1word

`define GPR_ADDR_MSB 5-1

`define WORD_MSB `WORD-1
`define WORD_ADDR_MSB `WORD_ADDR_W-1
`define RegAddrBus `GPR_ADDR_MSB:0


module EX_sim();
	reg				   clk=0;			// ????N????????????b????N
	reg				   reset;		// ???????????????????????????Z????b????g

  reg 				   stall;		   // ????ｽX????ｽg????ｽ[????ｽ????ｽ
  reg 				   flush;		   // ????ｽt????ｽ????ｽ????ｽb????ｽV????ｽ????ｽ
  reg 				   int_detect;	   // ????ｽ????ｽ????ｽ闕橸ｿｽﾝ鯉ｿｽ????ｽo
  reg  [`WORD_MSB:0] fwd_data;
  reg  [`WORD_ADDR_MSB:0] id_pc;		   // ????ｽv????ｽ????ｽ????ｽO????ｽ????ｽ????ｽ????ｽ????ｽJ????ｽE????ｽ????ｽ????ｽ^
  reg 				   id_en;		   // ????ｽp????ｽC????ｽv????ｽ????ｽ????ｽC????ｽ????ｽ????ｽf????ｽ[????ｽ^????ｽﾌ有????ｽ????ｽ
  reg 				   id_br_flag;	   // ????ｽ????ｽ????ｽ????ｽ????ｽt????ｽ????ｽ????ｽO
  reg [3:0] id_alu_op;
  reg [`WORD_MSB:0] id_alu_in_0;
  reg [`WORD_MSB:0] id_alu_in_1;
  reg  [1:0]	   id_mem_op;	   // ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽI????ｽy????ｽ????ｽ????ｽ[????ｽV????ｽ????ｽ????ｽ????ｽ
  reg  [`WORD_MSB:0] id_mem_wr_data; // ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝデ????ｽ[????ｽ^
  reg  [1:0]   id_ctrl_op;	   // ????ｽ????ｽ????ｽ艫鯉ｿｽW????ｽX????ｽ^????ｽI????ｽy????ｽ????ｽ????ｽ[????ｽV????ｽ????ｽ????ｽ????ｽ
  reg  [`RegAddrBus]  id_dst_addr;	   // ????ｽﾄ用????ｽ????ｽ????ｽW????ｽX????ｽ^????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝア????ｽh????ｽ????ｽ????ｽX
  reg 				   id_gpr_we_;	   // ????ｽﾄ用????ｽ????ｽ????ｽW????ｽX????ｽ^????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝ有????ｽ????ｽ
  reg  [2:0]   id_exp_code;	   // ????ｽ????ｽ????ｽO????ｽR????ｽ[????ｽh
  /********** EX/MEM????ｽp????ｽC????ｽv????ｽ????ｽ????ｽC????ｽ????ｽ????ｽ????ｽ????ｽW????ｽX????ｽ^ **********/
  wire [`WORD_ADDR_MSB:0] ex_pc;		   // ????ｽv????ｽ????ｽ????ｽO????ｽ????ｽ????ｽ????ｽ????ｽJ????ｽE????ｽ????ｽ????ｽ^
  wire				   ex_en;		   // ????ｽp????ｽC????ｽv????ｽ????ｽ????ｽC????ｽ????ｽ????ｽf????ｽ[????ｽ^????ｽﾌ有????ｽ????ｽ
  wire				   ex_br_flag;	   // ????ｽ????ｽ????ｽ????ｽ????ｽt????ｽ????ｽ????ｽO
  wire [1:0]	   ex_mem_op;	   // ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽI????ｽy????ｽ????ｽ????ｽ[????ｽV????ｽ????ｽ????ｽ????ｽ
  wire [`WORD_MSB:0] ex_mem_wr_data; // ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝデ????ｽ[????ｽ^
  wire [1:0]   ex_ctrl_op;	   // ????ｽ????ｽ????ｽ艫鯉ｿｽW????ｽX????ｽ^????ｽI????ｽy????ｽ????ｽ????ｽ[????ｽV????ｽ????ｽ????ｽ????ｽ
  wire [`RegAddrBus]  ex_dst_addr;	   // ????ｽﾄ用????ｽ????ｽ????ｽW????ｽX????ｽ^????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝア????ｽh????ｽ????ｽ????ｽX
  wire				   ex_gpr_we_;	   // ????ｽﾄ用????ｽ????ｽ????ｽW????ｽX????ｽ^????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝ有????ｽ????ｽ
  wire [2:0]   ex_exp_code;	   // ????ｽ????ｽ????ｽO????ｽR????ｽ[????ｽh
  wire [`WORD_MSB:0] ex_out;		   // ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ

  /********** ALU????ｽﾌ出????ｽ????ｽ **********/
  wire [`WORD_MSB:0]		   alu_out;		   // ????ｽ????ｽ????ｽZ????ｽ????ｽ????ｽ????ｽ
  wire					   alu_of;		   // ????ｽI????ｽ[????ｽo????ｽt????ｽ????ｽ????ｽ[

  /********** ????ｽ????ｽ????ｽZ????ｽ????ｽ????ｽﾊのフ????ｽH????ｽ????ｽ????ｽ[????ｽf????ｽB????ｽ????ｽ????ｽO **********/



  stage_EX ex(
	clk,			   // ????ｽN????ｽ????ｽ????ｽb????ｽN
	reset,		   // ????ｽ同奇ｿｽ????ｽ????ｽ????ｽZ????ｽb????ｽg
	stall,		   // ????ｽX????ｽg????ｽ[????ｽ????ｽ
	flush,		   // ????ｽt????ｽ????ｽ????ｽb????ｽV????ｽ????ｽ
	int_detect,	   // ????ｽ????ｽ????ｽ闕橸ｿｽﾝ鯉ｿｽ????ｽo
    fwd_data,
    id_pc,		   // ??ｽ????ｽO????ｽ????ｽ????ｽ????ｽ????ｽJ????ｽE????ｽ????ｽ????ｽ^
	id_en,		   // ???ｽv????ｽ????ｽ????ｽC????ｽ????ｽ????ｽf????ｽ[????ｽ^????ｽﾌ有????ｽ????ｽ
	id_br_flag,	   // ????ｽ????ｽ????ｽ????ｽ????ｽt????ｽ????ｽ????ｽO
    id_alu_op,
    id_alu_in_0,
    id_alu_in_1,
    id_mem_op,	   // ?ｽ????ｽ????ｽ????ｽ????ｽI????ｽy????ｽ????ｽ????ｽ[????ｽV????ｽ????ｽ????ｽ????ｽ
    id_mem_wr_data, // ?ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝデ????ｽ[????ｽ^
	id_ctrl_op,	   // ????ｽ????ｽ????ｽ艫鯉ｿｽW????ｽX????ｽ^????ｽI????ｽy????ｽ????ｽ????ｽ[????ｽV????ｽ????ｽ????ｽ????ｽ
	id_dst_addr,	   //
	id_gpr_we_,	   // ????ｽﾄ用????ｽ????ｽ????ｽW????ｽX????ｽ^????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝ有????ｽ????ｽ
  	id_exp_code,	   // ????ｽ????ｽ????ｽO????ｽR????ｽ[????ｽh
  	ex_pc,		   // ????ｽv????ｽ????ｽ????ｽO????ｽ????ｽ????ｽ????ｽ????ｽJ????ｽE????ｽ????ｽ????ｽ^
  	ex_en,		   // ????ｽp????ｽC????ｽv????ｽ????ｽ????ｽC????ｽ????ｽ????ｽf????ｽ[????ｽ^????ｽﾌ有????ｽ????ｽ
  	ex_br_flag,	   // ????ｽ????ｽ????ｽ????ｽ????ｽt????ｽ????ｽ????ｽO
  	ex_mem_op,	   // ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽI????ｽy????ｽ????ｽ????ｽ[????ｽV????ｽ????ｽ????ｽ????ｽ
  	ex_mem_wr_data, // ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽﾝデ????ｽ[????ｽ^
  	ex_ctrl_op,	   // ????ｽ????ｽ????ｽ艫鯉ｿｽW????ｽX????ｽ^????ｽI????ｽy????ｽ????ｽ????ｽ[????ｽV????ｽ????ｽ????ｽ????ｽ
  	ex_dst_addr,	   //
  	ex_gpr_we_,	   // ????ｽﾄ用????ｽ????ｽ????ｽW????ｽX????ｽ????ｽ
  	ex_exp_code,	   // ????ｽ????ｽ????ｽO????ｽR????ｽ[????ｽh
  	ex_out		   // ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ????ｽ
  );

    always begin
       clk=~clk; #(5);
    end


  initial begin
    reset = 1;
		#(2)
    reset <= 0;
		repeat(2) @(posedge clk);
    reset <= 1;
	 id_alu_in_0=10;
	 id_alu_in_1=20;
		stall=0;
		flush=0;
     repeat(200) @(posedge clk);
		stall=0;
		flush=1;
    repeat(200) @(posedge clk);
		stall=1;
		flush=0;
    repeat(200) @(posedge clk);
		stall=1;
		flush=1;
		repeat(200) @(posedge clk);
		stall=0;
		flush=0;
		repeat(200) @(posedge clk);
   	repeat(200) @(posedge clk);
   $finish;
  end

endmodule
